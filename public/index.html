<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Today's Date Snapshot ‚Äî week number, quarter, day of year, year progress, moon phase, solstice countdown, and more.">

  <!-- OpenGraph tags-->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Date Dashboard">
  <meta property="og:description"
    content="Today's Date Snapshot ‚Äî week number, quarter, day of year, year progress, moon phase, solstice countdown, and more.">
  <meta property="og:url" content="https://raul.viigipuu.ee/apps/week/">
  <meta property="og:image" content="https://raul.viigipuu.ee/apps/week/images/image.jpg">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Date Dashboard">
  <meta name="twitter:description"
    content="Today's Date Snapshot ‚Äî week number, quarter, day of year, year progress, moon phase, solstice countdown, and more.">
  <meta name="twitter:image" content="https://raul.viigipuu.ee/apps/week/images/image.jpg">
  <meta name="twitter:url" content="https://raul.viigipuu.ee/apps/week/">

  <link rel="canonical" href="https://raul.viigipuu.ee/apps/week/">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Date Dashboard",
    "url": "https://raul.viigipuu.ee/apps/week/",
    "description": "Today's Date Snapshot ‚Äî week number, quarter, day of year, year progress, moon phase, solstice countdown, and more.",
    "inLanguage": "en",
    "author": {
      "@type": "Person",
      "name": "Raul Viigipuu",
      "url": "https://raul.viigipuu.ee/"
    },
    "publisher": {
      "@type": "Person",
      "name": "Raul Viigipuu"
    },
    "image": {
      "@type": "ImageObject",
      "url": "https://raul.viigipuu.ee/apps/week/images/image.jpg",
      "width": 1200,
      "height": 630
    }
  }
  </script>


  <title>Date Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
      padding: 0 10px;
    }

    .year,
    .date {
      font-weight: bold;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.15);
    }

    .year {
      font-size: 48px;
      color: #333;
      margin-top: 0;
      margin-bottom: 10px;
      text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.2);
    }

    .date {
      font-size: 22px;
      margin-top: 0;
      margin-bottom: 20px;
    }

    .container-wrapper {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .container {
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      width: 220px;
      white-space: nowrap;
      overflow: hidden;
    }

    .label {
      font-size: 20px;
      font-weight: bold;
      white-space: nowrap;
    }

    .value {
      font-size: 24px;
      color: #007bff;
    }

    .subtext {
      font-size: 16px;
      color: #666;
      margin-left: 5px;
    }

    .time-cell {
      font-family: monospace;
      font-weight: 500;
      text-align: left;
    }

    .progress-bar-wrapper {
      width: 100%;
      height: 10px;
      background-color: #eee;
      border-radius: 5px;
      margin-top: 10px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background-color: #007bff;
      width: 0%;
      transition: width 0.5s ease;
    }

    .timestamp-style {
      font-size: 14px;
      font-family: system-ui, sans-serif;
      color: #444;
      opacity: 0.85;
      text-align: center;
      margin-top: 8px;
      line-height: 1.4;
    }

    .timestamp-style .label {
      font-weight: 500;
      font-size: 14px;
    }

    .timestamp-style .code {
      font-family: monospace;
    }

    #newYearCountdownSection {
      margin-top: 20px;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    @media (max-width: 600px) {
      .container-wrapper {
        flex-direction: column;
        align-items: center;
      }

      .container {
        width: 100%;
        max-width: 300px;
        white-space: normal;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1 class="year" id="currentYear" aria-live="polite">Loading...</h1>
    <p class="date" id="currentDate" aria-live="polite">Loading...</p>
  </header>

  <main aria-labelledby="dashboardHeading">
    <h2 id="dashboardHeading" class="sr-only">Date Dashboard Metrics</h2>
    <div class="container-wrapper">
      <div class="container">
        <div class="label">Current Week Number:</div>
        <div class="value">
          <div id="weekNumber" aria-live="polite" aria-label="Current ISO week number">Loading...</div>
          <div class="timestamp-style">
            <span class="label">ISO week:</span>
            <span class="code" id="isoWeek" aria-live="polite">Loading...</span>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="label">Day Number in Year:</div>
        <div class="value">
          <div id="dayOfYear" aria-live="polite">Loading...</div>
          <div class="timestamp-style">
            <span class="label">of</span>
            <span class="code" id="totalDays">365</span>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="label">Year Progress:</div>
        <div class="value" id="yearProgress" aria-live="polite">Loading...</div>
        <div class="progress-bar-wrapper">
          <div class="progress-bar" id="progressFill"></div>
        </div>
      </div>
      <div class="container">
        <div class="label">Quarter:</div>
        <div class="value">
          <div id="quarterMain" aria-live="polite">Q2</div>
          <div class="timestamp-style">
            <span class="label">of</span>
            <span class="code" id="quarterYear" aria-live="polite">2025</span>
          </div>
        </div>
      </div>
    </div>

    <div id="newYearCountdownSection" class="timestamp-style">
      <span class="label">Countdown to New Year üéâ:</span>
      <span class="code" id="newYearCountdown" role="timer" aria-live="off">Loading...</span>
    </div>

    <div id="solsticeInfo" class="timestamp-style" aria-live="polite"></div>

    <div id="moonPhaseSection" class="timestamp-style">
      <span class="label">Moon phase:</span>
      <span class="code" id="moonPhaseText" aria-live="polite">Loading...</span>
    </div>

    <div id="loadTimeCard" style="margin-top: 40px; font-size: 14px; color: #555; opacity: 0.85">
      <table style="margin: 0 auto; font-family: monospace; border-spacing: 0 6px">
        <tr>
          <td style="font-weight: bold; text-align: right; padding-right: 8px">
            GMT:
          </td>
          <td class="time-cell">
            <time id="gmtTime" datetime="2025-01-01T00:00:00Z">Loading...</time>
          </td>
        </tr>
        <tr>
          <td style="font-weight: bold; text-align: right; padding-right: 8px">
            UTC:
          </td>
          <td class="time-cell">
            <time id="utcTime" datetime="2025-01-01T00:00:00Z">Loading...</time>
          </td>
        </tr>
        <tr>
          <td style="font-weight: bold; text-align: right; padding-right: 8px">
            Unix:
          </td>
          <td id="unixTime" style="text-align: left; font-family: monospace"></td>
        </tr>
      </table>
    </div>
  </main>

  <script>
    // UTILS
    function getISOWeekParts(date) {
      const temp = new Date(
        Date.UTC(date.getFullYear(), date.getMonth(), date.getDate())
      );
      const dayNum = temp.getUTCDay() || 7;
      temp.setUTCDate(temp.getUTCDate() + 4 - dayNum);
      const isoYear = temp.getUTCFullYear();
      const yearStart = new Date(Date.UTC(isoYear, 0, 1));
      const weekNo = Math.ceil(((temp - yearStart) / 86400000 + 1) / 7);
      return { isoYear, weekNo };
    }

    function getISOWeekString(date) {
      const { isoYear, weekNo } = getISOWeekParts(date);
      return `${isoYear}-W${String(weekNo).padStart(2, "0")}`;
    }

    function getDayOfYear(date) {
      const utcDate = Date.UTC(date.getFullYear(), date.getMonth(), date.getDate());
      const utcYearStart = Date.UTC(date.getFullYear(), 0, 0);
      return Math.floor((utcDate - utcYearStart) / 86400000);
    }

    function isLeapYear(year) {
      return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
    }

    function formatDate(date) {
      return date.toLocaleDateString(undefined, {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      });
    }

    function formatDateTime(date, useUTC = false) {
      const get = (fn) => String(fn.call(date)).padStart(2, "0");
      const yyyy = useUTC ? date.getUTCFullYear() : date.getFullYear();
      const month = useUTC ? date.getUTCMonth() : date.getMonth();
      const mm = String(month + 1).padStart(2, "0");
      const dd = get(useUTC ? date.getUTCDate : date.getDate);
      const hh = get(useUTC ? date.getUTCHours : date.getHours);
      const min = get(useUTC ? date.getUTCMinutes : date.getMinutes);
      const ss = get(useUTC ? date.getUTCSeconds : date.getSeconds);
      return `${yyyy}.${mm}.${dd} ${hh}:${min}:${ss}`;
    }

    function getGMTOffsetString(date) {
      const offset = -date.getTimezoneOffset();
      const sign = offset >= 0 ? "+" : "-";
      const hours = String(Math.floor(Math.abs(offset) / 60)).padStart(
        2,
        "0"
      );
      const minutes = String(Math.abs(offset) % 60).padStart(2, "0");
      return `${sign}${hours}:${minutes}`;
    }

    function getQuarterInfo(date) {
      const quarter = Math.floor(date.getMonth() / 3) + 1;
      return `Q${quarter}`;
    }

    function getNewYearCountdownString() {
      const now = new Date();
      const nextYear = now.getFullYear() + 1;
      const newYear = new Date(nextYear, 0, 1, 0, 0, 0, 0);
      const diffMs = newYear - now;
      if (diffMs <= 0) return "Happy New Year!";

      const totalSec = Math.floor(diffMs / 1000);
      const days = Math.floor(totalSec / (3600 * 24));
      const hours = Math.floor((totalSec % (3600 * 24)) / 3600);
      const minutes = Math.floor((totalSec % 3600) / 60);
      const seconds = totalSec % 60;

      return `${days}d ${hours}h ${minutes}m ${seconds}s until ${nextYear}`;
    }

    function getMoonPhase(date) {
      const lunarCycle = 29.530588853;
      const knownNewMoon = new Date(Date.UTC(2000, 0, 6, 18, 14));
      const diff = date - knownNewMoon;
      const days = diff / 86400000;
      const phase = ((days % lunarCycle) + lunarCycle) % lunarCycle;
      const percent = Math.round((phase / lunarCycle) * 100);

      let name = "",
        emoji = "",
        est = "";

      if (phase < 1) {
        name = "New Moon";
        emoji = "üåë";
      } else if (phase < 7.4) {
        name = "Waxing Crescent";
        emoji = "üåí";
      } else if (phase < 8.4) {
        name = "First Quarter";
        emoji = "üåì";
      } else if (phase < 14.8) {
        name = "Waxing Gibbous";
        emoji = "üåî";
      } else if (phase < 15.8) {
        name = "Full Moon";
        emoji = "üåï";
      } else if (phase < 22.1) {
        name = "Waning Gibbous";
        emoji = "üåñ";
      } else if (phase < 23.1) {
        name = "Last Quarter";
        emoji = "üåó";
      } else {
        name = "Waning Crescent";
        emoji = "üåò";
      }

      return `${emoji} ${name} (${percent}%)`;
    }

    function startCountdown() {
      const el = document.getElementById("newYearCountdown");
      function tick() {
        el.textContent = getNewYearCountdownString();
      }
      tick(); // initial render
      setInterval(tick, 1000); // live update every second
    }

    function getNextSolstice(today) {
      const knownSummerDayByYear = {
        2024: 20,
        2025: 20,
        2026: 21,
        2027: 21,
        2028: 20,
        2029: 21,
        2030: 21,
      };
      const currentYear = today.getFullYear();
      const solstices = [];

      for (let year = currentYear - 1; year <= currentYear + 30; year += 1) {
        const summerDay = knownSummerDayByYear[year] || 21;
        solstices.push({
          date: new Date(Date.UTC(year, 5, summerDay)),
          name: "Summer Solstice",
        });
        solstices.push({
          date: new Date(Date.UTC(year, 11, 21)),
          name: "Winter Solstice",
        });
      }

      for (const s of solstices) {
        if (s.date > today) {
          return {
            name: s.name,
            date: s.date,
          };
        }
      }

      return null;
    }

    function updateSolsticeInfo() {
      const now = new Date();
      const next = getNextSolstice(now);
      if (!next) return;

      const diffDays = Math.floor((next.date - now) / 86400000);
      const label = `<span class="label">Next solstice ‚òÄÔ∏è:</span> <span class="code">${next.name
        } ‚Äî ${next.date.toDateString()} (${diffDays} day${diffDays !== 1 ? "s" : ""
        } left)</span>`;

      document.getElementById("solsticeInfo").innerHTML = label;
    }

    // MAIN UPDATE
    function updateUI() {
      const now = new Date();
      const year = now.getFullYear();
      const totalDays = isLeapYear(year) ? 366 : 365;

      document.getElementById("currentYear").textContent = year;
      document.getElementById("currentDate").textContent = formatDate(now);
      const { weekNo } = getISOWeekParts(now);
      document.getElementById("weekNumber").textContent = weekNo;
      document.getElementById("isoWeek").textContent = getISOWeekString(now);

      document.getElementById("dayOfYear").textContent = getDayOfYear(now);
      document.getElementById("totalDays").textContent = totalDays;

      document.getElementById("gmtTime").textContent =
        formatDateTime(now, false) + ` (GMT${getGMTOffsetString(now)})`;
      document
        .getElementById("gmtTime")
        .setAttribute("datetime", now.toISOString());

      document.getElementById("utcTime").textContent =
        formatDateTime(now, true) + ` (UTC)`;
      document
        .getElementById("utcTime")
        .setAttribute("datetime", now.toISOString());
      document.getElementById("unixTime").textContent = Math.floor(
        Date.now() / 1000
      );

      const currentDay = getDayOfYear(now);
      const progressPercent = ((currentDay / totalDays) * 100).toFixed(1);
      document.getElementById(
        "yearProgress"
      ).textContent = `${progressPercent}%`;
      document.getElementById(
        "progressFill"
      ).style.width = `${progressPercent}%`;

      document.getElementById("quarterMain").textContent =
        getQuarterInfo(now);
      document.getElementById("quarterYear").textContent = now.getFullYear();

      document.getElementById("moonPhaseText").textContent =
        getMoonPhase(now);
    }

    updateUI();
    startCountdown();
    updateSolsticeInfo();
  </script>
  <script>
    // Put domain into the recorded path so each site stays separable
    window.goatcounter = {
      path: function (p) {
        return location.host + location.pathname;
      }
    };
  </script>
  <script data-goatcounter="https://stats.nonzero.ee/count" async src="https://stats.nonzero.ee/count.js"></script>
</body>

</html>
